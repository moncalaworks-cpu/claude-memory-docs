name: Quality Check

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  spell-check:
    name: Spell Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install cspell
        run: npm install -g cspell

      - name: Run spell check
        run: cspell '**/*.md' --config .cspell.json || true

  structure-validation:
    name: Structure Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Validate structure
        run: |
          # Check MEMORY.md exists
          if [ ! -f "MEMORY.md" ]; then
            echo "❌ MEMORY.md not found"
            exit 1
          fi
          
          # Check for orphaned files (but don't fail)
          orphaned_count=0
          for file in *.md; do
            if [ "$file" != "MEMORY.md" ]; then
              if ! grep -q "$(basename $file)" MEMORY.md; then
                echo "⚠️  Orphaned file (not referenced in MEMORY.md): $file"
                ((orphaned_count++))
              fi
            fi
          done
          
          echo "✅ Structure validation passed"

  link-validation:
    name: Link Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install
        working-directory: ${{ github.workspace }}

      - name: Validate links
        run: node scripts/validate-links.js
        working-directory: ${{ github.workspace }}
