name: Quality Check

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  markdownlint:
    name: Markdown Linting
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run markdownlint
        uses: nosborn/github-action-markdown-cli@v3.3.0
        with:
          files: .
          config_file: .markdownlint.json

  spell-check:
    name: Spell Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install cspell
        run: npm install -g cspell

      - name: Run spell check
        run: cspell '**/*.md' --config .cspell.json

  format-check:
    name: Format Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install prettier
        run: npm install -g prettier

      - name: Check formatting
        run: prettier --check '**/*.md'

  structure-validation:
    name: Structure Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Validate structure
        run: |
          # Check MEMORY.md exists
          if [ ! -f "MEMORY.md" ]; then
            echo "❌ MEMORY.md not found"
            exit 1
          fi
          
          # Check for orphaned files
          orphaned_count=0
          for file in *.md; do
            if [ "$file" != "MEMORY.md" ]; then
              if ! grep -q "$(basename $file)" MEMORY.md; then
                echo "⚠️  Orphaned file (not referenced in MEMORY.md): $file"
                ((orphaned_count++))
              fi
            fi
          done
          
          if [ $orphaned_count -gt 0 ]; then
            echo "❌ Found $orphaned_count orphaned files"
            exit 1
          fi
          
          echo "✅ Structure validation passed"
